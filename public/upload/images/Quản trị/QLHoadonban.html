<!DOCTYPE html>
<html>
<title>Quản lý hóa đơn bán</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../style/style.css">
<link rel="stylesheet" href="../style/main_ index.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/e06076012c.js" crossorigin="anonymous"></script>
<script src="js/java_jqu.js"></script>
<body>
    <!-- Sidebar -->
    <section class="header">
        <a href="javascript:void(0);" class="icon" onclick="openBTN()">
            <i class="fas fa-bars"></i>
        </a>
        <div class="box-login" id="box-t">Xin chào,<span id="tenkhachhang">Admin</span><i class="fas fa-sort-down"></i>
            <div class="box-login-bottom" id="box-b">
                <button onclick="trangchu()"><i class="fas fas fas fa-reply"></i>Vào trang web</button>
                <button onclick="TTTaiKhoan()"><i class="fas fa-user-alt"></i> Tài khoản</button>
                <button onclick="LogOut();"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
            </div>
        </div>
    </section>
    <section class="main">
        <div class="row">
            <div class="col-2 col-s-12 category">
                <div class="bgbtn"></div>
                <a href="../index.html"><i class="fa fa-reply" aria-hidden="true"></i>Trang quản trị</a>
                <a href="../Quản trị/QLsanpham.html"><i class="fas fa-barcode"></i> Sản phẩm</a>
                <a href="../Quản trị/QLLoaisanpham.html"><i class="fas fa-boxes"></i> Loại sản phẩm</a>
                <a href="../Quản trị/QL nhacungcap.html"><i class="fas fa-truck"></i> Nhà cung cấp</a>
                <a href="../Quản trị/QLNhanvien.html"><i class="fas fa-user"></i> Nhân viên</a>
                <a href="../Quản trị/QLHoadonnhap.html"><i class="fas fa-file-import"></i> Hóa đơn nhập</a>
                <a href="../Quản trị/QLHoadonban.html"><i class="fas fa-shopping-cart"></i> Hóa đơn bán</a>
           </div>
        <div class="col-10 col-s-12 content">
            <div class="col-12 col-s-12 content">
                <div class="col-6 col-s-12">
            <form action="">
                <div class="wraps">Nhập thông tin hóa đơn bán</div>
                <div class="wrap-field">
                    <label for="">Mã hóa đơn : </label>
                    <div class="col-12 col-s-12">
                        <input type="text" name="" placeholder="Nhập mã hóa đơn bán..." id="MaHDB"required>
                    </div>
                </div>
                <div class="wrap-field">
                    <label for=""> Tên nhân viên bán : </label>
                   <div class="col-12 col-s-12">
                    <input type="text" name="" placeholder="Nhập tên nhân viên bán..." id="Manvb"required>
                   </div>
                </div>
                <div class="wrap-field">
                    <label for="">Khách hàng : </label>
                   <div class=" col-12 col-s-12">
                    <input type="text" name="" placeholder="Nhập tên khách hàng..." id="kh"required>
                   </div>
                </div>
                <div class="wrap-field">
                    <label for="">số lượng : </label>
                   <div class="col-12 col-s-12">
                    <input type="text" name="" placeholder="Nhập nhập số lượng..." id="slg"required>
                   </div>
                </div>
                <div class="wrap-field">
                        <label for="">Giá sản phẩm : </label>
                       <div class="col-12 col-s-12">
                        <input type="text" name="" placeholder="Nhập giá sản phẩm..." id="gia"required>
                       </div>
                    </div>
                    <div class="wrap">
                        <input onclick="Addhdb()" type="submit" value="Add">
                        <input onclick="resetall()" type="submit" value="Reset">
                        <input id="sua" type="submit" value="Edit">
                    </div>
            </form>
       </div>
   <div class=" col-6 col-s-12 float_right">
    <div class="warps1">Danh sách hóa đơn bán</div>
           <div class="search">
                <input type="text" name="" id="myhdban" placeholder="Search...">
            </div>
        <table cellspacing="0">
            <tr style="background-color: rgb(13, 167, 46);height: 50px;">
                        <th>Mã HDB</th>
                        <th>Tên NV</th>
                        <th>Khách hàng</th>
                        <th>Số lượng</th>
                        <th>Giá sp</th>
                        <th>Tổng</th>
                        <th>Tác vụ</th>
            </tr>
            <tbody id="myhdb">
            </tbody>
        </table>
       <div style="line-height: 2em; background-color: rgb(27, 177, 27);margin-left: -16px;margin-top: 20px;">
        <label>Tổng thành tiền hóa đơn: </label> 
         <span id="Thanhtien">0</span>
    </div>
   <script>
        function Addhdb()
        {
            var arr=document.getElementsByTagName('input');
            var MaHDB=arr[0].value;
            var Manvb=arr[1].value;
            var kh=arr[2].value;
            var slg=arr[3].value;
            var gia=arr[4].value;
            if(MaHDB==""||Manvb==""||kh==""||slg==""||gia=="")
            {
                        alert("Không được để ô rỗng");
                        return;
            }
            if(MaHDB.length>10||isNaN(MaHDB))
            {
                        alert("Mã hóa đơn bán không hợp lệ.Mời nhập lại mã ! ");
                        return;
            }
            if(Manvb.length>50)
            {
                        alert("Tên nhân viên bán không hợp lệ.Mời nhập lại !")
            }      
             if(kh.length>50) 
            {
                        alert("Tên khách hàng không hợp lệ.Vui lòng nhập lại");
                        return;
            }
            if(isNaN(slg))
            {
                        alert("Số lượng không hợp lệ.Vui lòng nhập lại")
                        return;
            }
            if(isNaN(gia))
            {
                        alert("Giá sản phẩm không hợp lệ.Vui lòng nhập lại")
                        return;
            }
            var Listhdb = JSON.parse(localStorage.getItem('QLhoadonbans'));
            if (Listhdb == null) Listhdb = [];
            var QLhoadonbans = {
                MaHDB:MaHDB,
                Manvb:Manvb,
                kh:kh,
                slg:slg,
                gia:gia
          
            };
            Listhdb.push(QLhoadonbans)
            localStorage.setItem('QLhoadonbans', JSON.stringify(Listhdb))
            alert("Thêm sản phẩm thành công !")
            location.reload();
        }
        var listb = JSON.parse(localStorage.getItem('QLhoadonbans'));
        function LoadHDB()
        {
            var str = "";
            var t=0;
            for (x of listb) {
                t+=x.slg * x.gia;
                str += `<tr>
                       <td>`+ x.MaHDB+ `</td>
                        <td>`+ x.Manvb + `</td>
                        <td>`+ x.kh + `</td>
                        <td>`+ x.slg + `</td>
                        <td>`+ x.gia + `</td>
                        <td>`+ (x.slg * x.gia) + `</td>
                        <td ><i onclick="Edit(event)" class="fa fa-pencil-square-o" aria-hidden="true"></i> <i onclick="Xoa(`+ x.MaHDB + `)" class="fa fa-trash-o" aria-hidden="true"></i></td>
                    </tr>
                `;
            }
            document.getElementById("myhdb").innerHTML = str;
            $("#Thanhtien").text(t);
        }
        LoadHDB();

        function resetall() {
            document.getElementsByTagName('form')[0].reset()
        }
        $(document).ready(function(){
            $("#myhdban").on("keyup", function() {
            var valuehdb = $(this).val().toLowerCase();
            $("#myhdb tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(valuehdb) > -1)
            });
            });
        });
        function Xoa(MaHDB) {
            var index = listb.findIndex(x => x.MaHDB == MaHDB);
            if (index >= 0) {
                listb.splice(index, 1);
            }
            localStorage.setItem('QLhoadonbans', JSON.stringify(listb));
            LoadHDB();  
        }
        function Edit(event) {
            var parent = event.target.parentElement.parentElement.children[0]; 
            console.log(parent.innerText);
            var Listhdb = JSON.parse(localStorage.getItem('QLhoadonbans'));
            for(let i=0;i<Listhdb.length;i++){
                if(Listhdb[i].MaHDB==parent.innerText.trim()){
             document.getElementById('MaHDB').value=Listhdb[i].MaHDB;
            document.getElementById('Manvb').value=Listhdb[i].Manvb;
            document.getElementById('kh').value=Listhdb[i].kh;
            document.getElementById('slg').value=Listhdb[i].slg; 
            document.getElementById('gia').value=Listhdb[i].gia;
             break;
                }
            }
            document.getElementById('sua').addEventListener('click',e=>{
                for(let i=0;i<Listhdb.length;i++){
                if(Listhdb[i].MaHDB==parent.innerText.trim()){
                    Listhdb[i].MaHDB = document.getElementById('MaHDB').value;
                    Listhdb[i].Manvb = document.getElementById('Manvb').value;
                    Listhdb[i].kh= document.getElementById('kh').value;
                    Listhdb[i].slg= document.getElementById('slg').value;
                    Listhdb[i].gia= document.getElementById('gia').value;
                    localStorage.setItem('QLhoadonbans',JSON.stringify(Listhdb));
                     break;
                } 
            }
            document.getElementById('MaHDB').value='';
            document.getElementById('Manvb').value='';
            document.getElementById('kh').value='';
            document.getElementById('slg').value=''; 
            document.getElementById('gia').value='';
            LoadHDB();
            })    
        }
        nameNV();
   </script>
    <!-- Page Content -->
    
</body>
</html>